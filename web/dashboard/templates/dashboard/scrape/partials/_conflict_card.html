{% load static %}
{% load pipeline %}
{% load dashboard_utils %}
{% stylesheet 'conflict_card' %}

<div class="card h-100">
    <div class="card-body d-flex flex-column">
        <div class="card-text mb-2 text-muted">
            <form data-doi="{{ paper.doi }}">
            {% csrf_token %}
            <input type="hidden" name="action">
            <input type="hidden" name="doi" value="{{ paper.doi }}">
                <table>
                <colgroup>
                   <col span="1" style="width: 15%;">
                   <col span="1" style="width: 42%;">
                   <col span="1" style="width: 43%;">
                </colgroup>
                    <tr>
                        <th></th>
                        <th>Newly Scraped Datapoint</th>
                        <th>DB Paper</th>
                    </tr>
                    <tr>
                        <th>URL:</th>
                        <td>
                            <input type="text" class="edit-field" name="url" value="{{ datapoint.url }}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.url != datapoint.url %}
                            <a target="_blank" rel="noopener noreferrer"
                               href="{{ paper.url }}">
                            {{ paper.url }}
                        </a>
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>DOI:</th>
                        <td>
                            <input type="text" class="edit-field" name="doi" value="{{ datapoint.doi }}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.doi != datapoint.doi %}
                            {{ paper.doi }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Title:</th>
                        <td>
                            <textarea class="edit-field" name="title" disabled> {{ datapoint.title }}</textarea>
                        </td>
                        <td class="col-differences">
                        {% if paper.title != datapoint.title %}
                            {{ paper.title }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Publication Date:</th>
                        <td>
                            <input type="date" class="edit-field" name="publication_date" value="{{ datapoint.publication_date }}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.publication_date != datapoint.publication_date %}
                            {{ paper.publication_date }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Authors:</th>
                        <td>
                            <textarea type="text" class="edit-field" name="authors" disabled>{{ datapoint.authors }} </textarea>
                        </td>
                        <td class="col-differences">
{#                            {{ paper.authors }} <br>#}
{#                            {{ datapoint.authors }} <br>#}
                            {% if paper.authors|sort|join:" // " != datapoint.authors|sort|join:" // " %}
                                {{ paper.authors }}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Abstract: </th>
                        <td>
                            <textarea type="text" class="edit-field" name="abstract" disabled>{{ datapoint.abstract }} </textarea>
                        </td>
                        <td class="col-differences">
                        {% if paper.abstract != datapoint.abstract %}
                            {{ paper.abstract }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>PDF URL:</th>
                        <td>
                            <input type="text" class="edit-field" name="pdf_url" value="{% if datapoint.pdf_url %}{{ datapoint.pdf_url }}{% else %}None{% endif %}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.pdf_url != datapoint.pdf_url %}
                            <a target="_blank" rel="noopener noreferrer" href="{{ paper.pdf_url }}">{{ paper.pdf_url }}</a>
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Version:</th>
                        <td>
                            <input type="text" class="edit-field" name="version" value="{{ datapoint.version }}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.version != datapoint.version %}
                            {{ paper.version }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Datasource:</th>
                        <td>
                            <input type="number" class="edit-field" name="datasource" value="{{ datapoint.datasource}}" disabled></td>
                        <td class="col-differences">
                            {% if paper.datasource != datapoint.datasource %}
                                {{ paper.datasource }}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Paperhost:</th>
                        <td>
                            <input type="text" class="edit-field" name="paperhost" value="{{ datapoint.paperhost }}" disabled>
                        </td>
                    </tr>
                    <tr>
                        <th>Pubmed ID:</th>
                        <td>
                            <input type="text" class="edit-field" name="pubmed_id" value="{% if datapoint.pubmed_id %}{{ datapoint.pubmed_id }}{% else %}None{% endif %}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.pubmed_id != datapoint.pubmed_id %}
                            {{ paper.pubmed_id }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Is preprint:</th>
                        <td>
                            <input type="checkbox" class="edit-field" name="is_preprint" {% if datapoint.is_preprint %}checked{% endif %} disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.is_preprint != datapoint.is_preprint %}
                            {{ paper.is_preprint }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Journal:</th>
                        <td>
                            <input type="text" class="edit-field" name="journal" value="{% if datapoint.journal %}{{ datapoint.journal }}{% else %}None{% endif %}" disabled>
                        </td>
                        <td class="col-differences">
                        {% if paper.journal != datapoint.journal %}
                            {{ paper.journal }}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Update timestamp:</th>
                        <td>{{ datapoint.update_timestamp }}</td>
                        <td class="col-differences">
                        {% if paper.update_timestamp != datapoint.update_timestamp %}
                            {{ paper.update_timestamp }}
                        {% endif %}
                        </td>
                    </tr>
                </table>
            <div>
                <button type="submit" class="btn mt-2 btn-outline-primary btn-accept">Accept Left</button>
            </div>
            <div>
                <button type="submit" class="btn mt-2 btn-outline-primary btn-discard">Discard Update</button>
            </div>
            <div>
                <button type="submit" class="btn mt-2 btn-outline-primary btn-modify">Modify</button>
            </div>
            </form>
        </div>
    </div>
</div>
